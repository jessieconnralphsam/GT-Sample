<!DOCTYPE html>
<html>
  <head>
    <title>Prediction Example</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.8.0"></script>
  </head>
  <body>
    <input type="file" id="image-input" accept="image/*">
    <button onclick="predict()">Predict</button>
    <div id="output"></div>

    <script>
      // Load the Teachable Machine model
      async function loadModel() {
        const model = await tf.loadLayersModel('js/model.json');
        return model;
      }

      // Preprocess the input image
      function preprocessImage(image) {
        // Resize the image to match the input shape of the model
        const resizedImage = tf.image.resizeBilinear(image, [224, 224]);

        // Normalize the pixel values between -1 and 1
        const normalizedImage = resizedImage.div(255).sub(0.5).mul(2);

        // Expand the dimensions to match the input shape of the model
        const batchedImage = normalizedImage.expandDims(0);

        return batchedImage;
      }

      // Make predictions with the model
      async function predict() {
        const imageInput = document.getElementById('image-input');
        const image = await loadImage(imageInput.files[0]);
        const preprocessedImage = preprocessImage(image);

        const model = await loadModel();
        const predictions = model.predict(preprocessedImage);
        const predictedLabel = predictions.argMax(1).dataSync()[0];

        console.log('Predicted Label:', predictedLabel);

        
        const labelMap = { 0: 'Healthy', 1: 'Blight'}; // Modify this mapping as per your label classes
        const predictedWord = labelMap[predictedLabel];

        // Print the predicted label as a word to the output div
        const outputDiv = document.getElementById('output');
        outputDiv.innerHTML = 'Output: ' + predictedWord;

        predictions.dispose();
        tf.dispose([image, preprocessedImage]);
      }

      // Load image using FileReader
      function loadImage(file) {
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onload = () => {
            const img = new Image();
            img.onload = () => resolve(tf.browser.fromPixels(img));
            img.onerror = (error) => reject(error);
            img.src = reader.result;
          };
          reader.readAsDataURL(file);
        });
      }
    </script>
  </body>
</html>
